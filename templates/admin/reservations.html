<!-- templates/admin/reservations.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Admin • Reservations</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@600;700&family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#121417; --card:#1d2024; --alt:#0f1114; --border:#3e444c;
      --text:#c4c9d4; --muted:#8e9297; --bright:#fff;
      --primary:#c39a3f; --primary-hover:#af8b39; --ring:rgba(195,154,63,.25);
      --danger:#f04747; --shadow:0 10px 40px rgba(0,0,0,.5);
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--text);font:16px/1.55 'Inter',system-ui,sans-serif;padding:24px}
    .container{max-width:1200px;margin:0 auto;display:grid;gap:18px}

    .header{display:flex;justify-content:space-between;align-items:center;border-bottom:1px solid var(--border);padding-bottom:12px}
    h1{margin:0;font:700 1.8rem 'Cinzel',serif;color:var(--bright)}
    .nav{display:flex;gap:12px;flex-wrap:wrap}
    a{color:var(--primary);text-decoration:none;font-weight:700}
    a:hover{text-decoration:underline}

    .flash{padding:12px 14px;border-radius:10px;border:1px solid var(--primary);
      background:rgba(195,154,63,.12);color:var(--primary);font-weight:700}
    .flash.error{border-color:var(--danger);background:rgba(240,71,71,.12);color:#fff}

    .card{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:18px;box-shadow:var(--shadow);border-top:3px solid var(--primary)}
    form.search{display:flex;gap:8px;flex-wrap:wrap;margin:6px 0 14px}
    input[type=text]{flex:1;min-width:260px;padding:10px 12px;border-radius:10px;border:1px solid var(--border);background:var(--alt);color:var(--bright)}
    input[type=text]:focus{outline:none;border-color:var(--primary);box-shadow:0 0 0 4px var(--ring)}
    button{padding:10px 14px;border:0;border-radius:10px;background:var(--primary);color:#0a0b0d;font-weight:800;cursor:pointer;font-family:'Cinzel',serif}
    button:hover{background:var(--primary-hover)}

    .toolbar{display:flex;gap:10px;align-items:center;justify-content:space-between;margin:10px 0 6px}
    .muted{color:var(--muted)}

    table{width:100%;border-collapse:collapse}
    th,td{padding:12px 14px;border-bottom:1px solid var(--border);text-align:left}
    th{color:var(--muted);font:700 .85rem 'Cinzel',serif;letter-spacing:.03em;text-transform:uppercase}
    code{background:var(--alt);padding:3px 6px;border-radius:8px;border:1px solid var(--border)}

    .pagination{display:flex;gap:6px;align-items:center;justify-content:flex-end;margin-top:12px;flex-wrap:wrap}
    .pagination a,.pagination span{padding:8px 10px;border-radius:10px;border:1px solid var(--border);background:var(--alt);color:var(--bright);text-decoration:none}
    .pagination .active{border-color:var(--primary);box-shadow:0 0 0 3px var(--ring)}
  </style>
</head>
<body>
  <div class="container">
    <!-- Header / nav -->
    <div class="header">
      <h1>Reservations</h1>
      <div class="nav">
        <a href="{{ url_for('admin.dashboard') }}">Dashboard</a>
        <a href="{{ url_for('admin.titles_page') }}">Titles</a>
        <a href="{{ url_for('admin.servers_page') }}">Servers</a>
        <a href="{{ url_for('admin.logout') }}">Logout</a>
      </div>
    </div>

    <!-- Flashes -->
    {% for category, message in get_flashed_messages(with_categories=True) %}
      <div class="flash {{ category }}">{{ message }}</div>
    {% endfor %}

    <div class="card">
      <!-- Search -->
      <form class="search" method="GET" action="{{ url_for('admin.reservations_page') }}">
        <input type="text" name="q" value="{{ q }}" placeholder="Search by title, IGN, or coords…" />
        <button type="submit">Search</button>
      </form>

      <div class="toolbar">
        <div class="muted">{{ total }} result{{ '' if total==1 else 's' }}</div>
        <div>
          <a class="muted" href="{{ url_for('admin.reservations_export', q=q) }}">Export CSV</a>
        </div>
      </div>

      <!-- Table -->
      <table>
        <thead>
          <tr>
            <th>Title</th>
            <th>IGN</th>
            <th>Coords</th>
            <th>Slot (UTC)</th>
          </tr>
        </thead>
        <tbody>
          {% for r in rows %}
            <tr>
              <td>{{ r.title_name }}</td>
              <td>{{ r.ign }}</td>
              <td><code>{{ r.coords }}</code></td>
              <td>{{ r.slot_dt.isoformat() if r.slot_dt else '' }}</td>
            </tr>
          {% else %}
            <tr><td colspan="4" class="muted">No reservations found.</td></tr>
          {% endfor %}
        </tbody>
      </table>

      <!-- Pagination -->
      {% if pages > 1 %}
        <div class="pagination">
          {% set prev = page - 1 %}
          {% set nextp = page + 1 %}
          {% if page > 1 %}
            <a href="{{ url_for('admin.reservations_page', q=q, page=1) }}">« First</a>
            <a href="{{ url_for('admin.reservations_page', q=q, page=prev) }}">‹ Prev</a>
          {% else %}
            <span>« First</span><span>‹ Prev</span>
          {% endif %}

          <span class="active">Page {{ page }} / {{ pages }}</span>

          {% if page < pages %}
            <a href="{{ url_for('admin.reservations_page', q=q, page=nextp) }}">Next ›</a>
            <a href="{{ url_for('admin.reservations_page', q=q, page=pages) }}">Last »</a>
          {% else %}
            <span>Next ›</span><span>Last »</span>
          {% endif %}
        </div>
      {% endif %}
    </div>
  </div>
</body>
</html>